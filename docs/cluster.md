# Summary

- `apps.tf`: Terraform configuration for deploying the research data management services.
- `databases.tf`: Terraform configuration for deploying the databases required by the services.
- `external`: Directory containing external scripts and files required by the project.
  - `databases/setup.sh`: Shell script for setting up the databases.
  - `keystone.py`: Python script for authenticating with the Keystone identity service.
- `firewall.tf`: Terraform configuration for setting up the firewall rules.
- `outputs.tf`: Terraform configuration for defining the output variables.
- `providers.tf`: Terraform configuration for defining the provider information.
- `variables.tf`: Terraform configuration for defining the input variables.
- `versions.tf`: Terraform configuration for defining the required Terraform version.

# Databases

## Automatic failover

https://repmgr.org/docs/4.0/repmgrd-basic-configuration.html#REPMGRD-AUTOMATIC-FAILOVER-CONFIGURATION


> 13.1.1. automatic failover configuration
>
> If using automatic failover, the following repmgrd options *must* be set in repmgr.conf:
>
> ```text
> failover=automatic
> promote_command='/usr/bin/repmgr standby promote -f /etc/repmgr.conf --log-to-file'
> follow_command='/usr/bin/repmgr standby follow -f /etc/repmgr.conf --log-to-file --upstream-node-id=%n'
> ```
> Adjust file paths as appropriate; we recomment specifying the full path to the repmgr binary.
>
> Note that the `--log-to-file` option will cause output generated by the repmgr command, when executed by repmgrd, to be logged to the same destination configured to receive log output for repmgrd. See `repmgr.conf.sample` for further repmgrd-specific settings.
>
> When failover is set to `automatic`, upon detecting failure of the current primary, repmgrd will execute one of:
>
> ```text
> promote_command (if the current server is to become the new primary)
> follow_command (if the current server needs to follow another server which has become the new primary)
> ```


terraform state mv openstack_compute_instance_v2.databases[0] openstack_compute_instance_v2.databases[1]